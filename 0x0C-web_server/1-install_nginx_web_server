#!/usr/bin/env bash
# This script installs and configures Nginx on an Ubuntu server

# Install Nginx
apt-get update
apt-get install -y nginx

# Start Nginx
service nginx start

# Make sure Nginx is listening on port 80
if ! netstat -tulpen | grep ":80" > /dev/null; then
    echo "Nginx is not listening on port 80. Check the installation."
    exit 1
fi

# Create a simple HTML page with "Hello World!"
echo "<html><body>Hello World!</body></html>" > /var/www/html/index.html

# Restart Nginx without using systemctl
kill -HUP $(cat /var/run/nginx.pid)

# Check if Nginx is running
if ! ps aux | grep "nginx: master" | grep -v grep > /dev/null; then
    echo "Nginx is not running. Check the installation."
    exit 1
fi

echo "Nginx installed and configured successfully."
